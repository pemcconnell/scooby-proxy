server {
    listen       80;
    server_name  {{.Subdomain}}.{{.Tld}};

    error_log /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;

    location / {
        {{if .Htpasswd}}
        auth_basic                       "Restricted";
        auth_basic_user_file             /etc/nginx/htpasswd.d/{{.Subdomain}};
        {{end}}
        resolver            {{.Resolver}};
        proxy_pass          http://{{.Subdomain}}.default.svc.cluster.local:{{.Port}}; 
        proxy_set_header    X-Real-IP   $remote_addr;
        proxy_set_header    Upgrade     $http_upgrade;
        proxy_set_header    Host        $http_host;
    }
}
